#!/usr/bin/env sh

# Run lint-staged to lint only staged files
npx lint-staged

# Run affected tests on staged files
echo "Running tests on affected files..."

# Check if any backend files are staged
BACKEND_FILES=$(git diff --cached --name-only -- 'backend/src/**/*.ts' 2>/dev/null || true)
if [ -n "$BACKEND_FILES" ]; then
  echo "Running backend tests for changed files..."
  cd backend && npm run test:staged 2>/dev/null || true
  cd ..
fi

# Check if any frontend files are staged
FRONTEND_FILES=$(git diff --cached --name-only -- 'frontend/src/**/*.ts' 'frontend/src/**/*.tsx' 2>/dev/null || true)
if [ -n "$FRONTEND_FILES" ]; then
  echo "Running frontend tests for changed files..."
  cd frontend && npm run test:staged 2>/dev/null || true
  cd ..
fi

echo "Pre-commit checks complete!"
